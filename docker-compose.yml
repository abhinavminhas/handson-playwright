services:
  playwright:
    image: mcr.microsoft.com/playwright:v1.56.1  # Official Playwright image
    container_name: playwright-runner
    working_dir: /app

    # Mount your local project into the container
    volumes:
      - .:/app

    # Run Playwright tests when the container starts
    command: >
      bash -c "
        apt-get update &&
        apt-get install -y fonts-liberation fonts-dejavu fonts-noto fonts-freefont-ttf &&
        npm ci &&
        npx playwright install --with-deps &&
        npx playwright test
      "

    # Needed for proper browser sandboxing and IPC
    ipc: host

    # Environment variables for headless execution (default in CI)
    environment:
      - CI=true
